(function(){var e=!1,a=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(b){function c(){!e&&this.init&&this.init.apply(this,arguments)}var d=this.prototype;e=!0;var j=new this;e=!1;for(var f in b)j[f]="function"==typeof b[f]&&"function"==typeof d[f]&&a.test(b[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var f=b.apply(this,arguments);this._super=c;return f}}(f,b[f]):b[f];c.prototype=j;c.prototype.constructor=c;c.extend=arguments.callee;
return c}})();
var _Loader=function(e){return Class.extend({init:function(){this.scripts={};this.templates={};this.cache={};this.clear(!0)},tmpl:function(a,b){var c=!/\W/.test(a)?this.cache[a]=this.cache[a]||this.tmpl(document.getElementById(a).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");
return b?c(b):c},head:document.head||document.getElementsByTagName("head")[0],storagePrefix:"loader-",templatePrefix:"template-",cssPrefix:"css-",defaultExpiration:5E3,set_storage:function(a,b){try{return localStorage.setItem(this.storagePrefix+a,JSON.stringify(b)),!0}catch(c){return!1}},wrapStoreData:function(a){var b=+new Date;a.stamp=b;a.expire=b+36E5*(a.expire||this.defaultExpiration);return a},injectCSS:function(a){var b=document.createElement("style");b.textContent=a;this.head.appendChild(b)},
injectScript:function(a){var b=document.createElement("script");b.defer=!0;b.text=a;this.head.appendChild(b)},injectCSSByUrl:function(a,b){b.href=a;this.head.appendChild(b);return e(b)},injectScriptByUrl:function(a,b,c){b.defer=!0;b.type="text/javascript";b.src=a;b.onload=c;b.onreadystatechange=c;this.head.appendChild(b);return e(b)},getUrl:function(a){var b=new XMLHttpRequest,c=new e.Deferred;b.open("GET",a);b.onreadystatechange=function(){4===b.readyState&&(200===b.status?c.resolve(b.responseText):
c.reject(Error(b.statusText)))};b.send();return c.promise()},prepScripts:function(a,b,c){if(a.url){var d=a.url.indexOf("http://"),j=a.url.indexOf("https://"),f=a.url.indexOf("//");!d&&(!j&&!f)&&(a.url="//"+a.url);a.key=a.key||a.url;var d=this.get(a.key),g=this,h=new e.Deferred,k;!d||0>d.expire-+new Date||a.unique!==d.unique?(a.unique&&(a.url+=(0<a.url.indexOf("?")?"&":"?")+"loader-cachebust="+a.unique),a.CORS||RegExp(location.origin).test(a.url)||-1==a.url.indexOf("//")?e.get(a.url,null,null,"script").then(function(b){g.injectScript(b);
a.text=b;g.set_storage(a.key,a);h.resolve()}):this.injectScriptByUrl(a.url,k=document.createElement("script"),function(){!k.readyState||/loaded|complete/.test(k.readyState)?(k.onload=k.onreadystatechange=null,h.resolve()):h.reject()})):(h.resolve(),this.injectScript(d.text));c[b]=h.promise()}},_load:function(a){var b=[],c;for(c in a)this.prepScripts(this.wrapStoreData(a[c]),c,b);return e.when.apply(e,b)},load:function(){var a=Array.prototype.slice.call(arguments);return this._load.call(this,a)},get:function(a){try{var b=
window.localStorage.getItem(this.storagePrefix+a);return e.parseJSON(b||"false")}catch(c){return!1}},clear:function(a){var b,c,d=+new Date;for(b in localStorage)(c=b.split(this.storagePrefix)[1])&&(!a||this.get(c).expire<=d)&&this.remove(c);return this},remove:function(a){localStorage.removeItem(this.storagePrefix+a);return this},_template:function(a,b,c){var d=this,j=this.get(this.templatePrefix+a);c[b]=j?d.tmpl(j):e.get(a).pipe(function(b){d.set_storage(d.templatePrefix+a,b);return d.tmpl(d.get(d.templatePrefix+
a))})},template:function(){var a=Array.prototype.slice.call(arguments),b=[];if(!a.length)return a=e.Deferred(),a.fail(),a.promise();for(var c in a)this._template(a[c],c,b);return e.when.apply(e,b)},prepCSS:function(a,b,c){if(a.url){var d=a.url.indexOf("http://"),j=a.url.indexOf("https://"),f=a.url.indexOf("//");!d&&(!j&&!f)&&(a.url="//"+a.url);a.key=a.key||a.url;var d=this.get(this.cssPrefix+a.key),g=this,h=new e.Deferred,k;!d||0>d.expire-+new Date||a.unique!==d.unique?(a.unique&&(a.url+=(0<a.url.indexOf("?")?
"&":"?")+"loader-cachebust="+a.unique),a.CORS||RegExp(location.origin).test(a.url)||-1==a.url.indexOf("//")?e.get(a.url).then(function(b){b=g.cssmin(b,800);g.injectCSS(b);a.text=b;g.set_storage(g.cssPrefix+a.key,a);h.resolve()}):(this.injectCSSByUrl(a.url,k=document.createElement("style"),function(){!k.readyState||/loaded|complete/.test(k.readyState)?h.resolve():h.reject()}),h.resolve())):(this.injectCSS(d.text),h.resolve());c[b]=h.promise()}},css:function(){var a=Array.prototype.slice.call(arguments);
return this._css.call(this,a)},_css:function(a){var b=[],c;for(c in a)this.prepCSS(this.wrapStoreData(a[c]),c,b);return e.when.apply(e,b)},cssmin:function(a,b){var c=0,d=0,e=!1,f=!1,f=d=0,g=[],f="";for(a=a.replace(/("([^\\"]|\\.|\\)*")|('([^\\']|\\.|\\)*')/g,function(a){var b=a[0];g.push(a.slice(1,-1));return b+"___YUICSSMIN_PRESERVED_TOKEN_"+(g.length-1)+"___"+b});0<=(c=a.indexOf("/*",c));)f=a.length>c+2&&"!"===a[c+2],d=a.indexOf("*/",c+2),0>d?f||(a=a.slice(0,c)):d>=c+2&&("\\"===a[d-1]?(a=a.slice(0,
c)+"/*\\*/"+a.slice(d+2),c+=5,e=!0):e&&!f?(a=a.slice(0,c)+"/**/"+a.slice(d+2),c+=4,e=!1):f?(f=a.slice(c+3,d),g.push(f),a=a.slice(0,c+2)+"___YUICSSMIN_PRESERVED_TOKEN_"+(g.length-1)+"___"+a.slice(d),e&&(e=!1),c+=2):a=a.slice(0,c)+a.slice(d+2));a=a.replace(/\s+/g," ");a=a.replace(/(^|\})(([^\{:])+:)+([^\{]*\{)/g,function(a){return a.replace(":","___YUICSSMIN_PSEUDOCLASSCOLON___")});a=a.replace(/\s+([!{};:>+\(\)\],])/g,"$1");a=a.replace(/___YUICSSMIN_PSEUDOCLASSCOLON___/g,":");a=a.replace(/:first-(line|letter)({|,)/g,
":first-$1 $2");a=a.replace(/\*\/ /g,"*/");a=a.replace(/^(.*)(@charset "[^"]*";)/gi,"$2$1");a=a.replace(/^(\s*@charset [^;]+;\s*)+/gi,"$1");a=a.replace(/\band\(/gi,"and (");a=a.replace(/([!{}:;>+\(\[,])\s+/g,"$1");a=a.replace(/;+}/g,"}");a=a.replace(/([\s:])(0)(px|em|%|in|cm|mm|pc|pt|ex)/gi,"$1$2");a=a.replace(/:0 0 0 0;/g,":0;");a=a.replace(/:0 0 0;/g,":0;");a=a.replace(/:0 0;/g,":0;");a=a.replace(/background-position:0;/gi,"background-position:0 0;");a=a.replace(/(:|\s)0+\.(\d+)/g,"$1.$2");a=a.replace(/rgb\s*\(\s*([0-9,\s]+)\s*\)/gi,
function(a,b){for(var c=b.split(","),d=0;d<c.length;d++)c[d]=parseInt(c[d],10).toString(16),1===c[d].length&&(c[d]="0"+c[d]);return"#"+c.join("")});a=a.replace(/([^"'=\s])(\s*)#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])/gi,function(){var a=arguments;return a[3].toLowerCase()===a[4].toLowerCase()&&a[5].toLowerCase()===a[6].toLowerCase()&&a[7].toLowerCase()===a[8].toLowerCase()?(a[1]+a[2]+"#"+a[3]+a[5]+a[7]).toLowerCase():a[0].toLowerCase()});a=a.replace(/[^\};\{\/]+\{\}/g,"");if(0<=
b)for(d=c=0;d<a.length;)"}"===a[d++]&&d-c>b&&(a=a.slice(0,d)+"\n"+a.slice(d),c=d);a=a.replace(/;;+/g,";");d=0;for(f=g.length;d<f;d++)a=a.replace("___YUICSSMIN_PRESERVED_TOKEN_"+d+"___",g[d]);return a=a.replace(/^\s+|\s+$/g,"")}})},browser="undefined"===typeof exports;browser?window.Loader=_Loader($):module.exports=function(e){return{Loader:_Loader(e)}};